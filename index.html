<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>Suara MiniApp</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <style>
    html, body {
      margin: 0;
      padding: 0;
      font-family: sans-serif;
      background: #014421;
      color: #fff;
      text-align: center;
      overflow-x: hidden;
    }
    .player-zone {
      position: relative;
      width: 90vmin;
      height: 90vmin;
      margin: 20px auto 10px auto;
      border-radius: 50%;
    }
    .player {
      position: absolute;
      width: 130px;
      background: rgba(255,255,255,0.85);
      border-radius: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
      flex-direction: column;
      color: black;
      font-weight: bold;
      font-size: 14px;
      padding: 8px;
      transition: 0.3s;
    }
    .player.winner {
      box-shadow: 0 0 20px 5px gold;
      animation: winner-glow 1s infinite alternate;
    }
    @keyframes winner-glow {
      from { box-shadow: 0 0 10px 2px gold; }
      to { box-shadow: 0 0 25px 10px gold; }
    }
    .player .cards {
      margin-top: 5px;
      display: flex;
      gap: 4px;
      flex-wrap: wrap;
      justify-content: center;
    }
    .player .score, .player .balance, .player .bet {
      margin-top: 4px;
      font-size: 13px;
    }
    .card {
      width: 36px;
      height: 52px;
      background-size: cover;
      border-radius: 4px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.3);
      opacity: 0;
      transform: translateY(-20px);
      animation: dealCard 0.5s forwards;
    }
    @keyframes dealCard {
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
    .deck {
      width: 48px;
      height: 72px;
      margin: 10px auto;
      background-image: url('https://raw.githubusercontent.com/hayeah/playing-cards-assets/master/png/back.png');
      background-size: cover;
      border-radius: 6px;
      box-shadow: 0 0 8px rgba(0,0,0,0.4);
    }
    #controls {
      margin-top: 20px;
    }
    button, input[type=number] {
      margin: 5px;
      padding: 10px 20px;
      border-radius: 10px;
      border: none;
      font-size: 1rem;
    }
    button {
      background-color: #0088cc;
      color: white;
      cursor: pointer;
    }
    input[type=number] {
      width: 80px;
    }
    #winner {
      font-size: 1.2rem;
      margin-top: 10px;
      font-weight: bold;
    }
  </style>
</head>
<body>
  <h1>Suara MiniApp</h1>
  <div class="deck"></div>
  <div class="player-zone" id="player-zone"></div>
  <div id="controls">
    <label>–°—Ç–∞–≤–∫–∞: <input type="number" id="betAmount" value="10" min="1"></label>
    <label>–ò–≥—Ä–æ–∫–æ–≤: <input type="number" id="playerCount" value="6" min="2" max="8"></label>
    <br>
    <button onclick="startGame()">–ù–∞—á–∞—Ç—å –∏–≥—Ä—É</button>
    <button onclick="resetGame()">üîÑ –ù–æ–≤–∞—è –∏–≥—Ä–∞</button>
    <button onclick="increaseBet()">‚ûï –£–≤–µ–ª–∏—á–∏—Ç—å —Å—Ç–∞–≤–∫—É</button>
    <button onclick="doubleBet()">‚úñÔ∏è –£–¥–≤–æ–∏—Ç—å —Å—Ç–∞–≤–∫—É</button>
    <button onclick="fold()">üö´ –°–¥–∞—Ç—å—Å—è</button>
    <button onclick="pass()">‚è≠ –ü–∞—Å</button>
  </div>
  <div id="winner"></div>

  <script>
    const cardFaces = ["2", "3", "4", "5", "6", "7", "8", "9", "10", "J", "Q", "K", "A"];
    const faceValues = {"2": 2, "3": 3, "4": 4, "5": 5, "6": 6, "7": 7, "8": 8, "9": 9, "10": 10, "J": 10, "Q": 10, "K": 10, "A": 11};
    const suits = ["H", "D", "C", "S"];
    let balances = [], scores = [], totalPlayers = 6, folds = [], bets = [];

    function createPlayers(n) {
      const container = document.getElementById('player-zone');
      container.innerHTML = '';
      scores = [];
      folds = [];
      bets = [];
      for (let i = 0; i < n; i++) {
        if (balances[i] === undefined) balances[i] = 100;
        const angle = (2 * Math.PI / n) * i;
        const x = 45 + 40 * Math.cos(angle);
        const y = 45 + 40 * Math.sin(angle);
        const playerDiv = document.createElement('div');
        playerDiv.className = 'player';
        playerDiv.id = `player-${i}`;
        playerDiv.style.left = x + '%';
        playerDiv.style.top = y + '%';
        playerDiv.innerHTML = `–ò–≥—Ä–æ–∫ ${i + 1}<div class="cards" id="cards-${i}"></div>
          <div class="score" id="score-${i}">–û—á–∫–∏: 0</div>
          <div class="balance" id="balance-${i}">–ë–∞–ª–∞–Ω—Å: ${balances[i]}</div>`;
        container.appendChild(playerDiv);
        folds[i] = false;
        bets[i] = 10;
      }
    }

    function dealCards() {
      let maxScore = 0;
      let winnerIndex = -1;

      for (let i = 0; i < totalPlayers; i++) {
        if (folds[i]) continue;
        const cardContainer = document.getElementById(`cards-${i}`);
        const scoreDisplay = document.getElementById(`score-${i}`);
        const balanceDisplay = document.getElementById(`balance-${i}`);
        if (!cardContainer) continue;
        cardContainer.innerHTML = '';
        let score = 0;

        for (let j = 0; j < 3; j++) {
          const face = cardFaces[Math.floor(Math.random() * cardFaces.length)];
          const suit = suits[Math.floor(Math.random() * suits.length)];
          const card = document.createElement('div');
          card.className = 'card';
          card.style.backgroundImage = `url('https://raw.githubusercontent.com/hayeah/playing-cards-assets/master/png/${face}${suit}.png')`;
          card.style.animationDelay = `${j * 0.2}s`;
          cardContainer.appendChild(card);
          score += faceValues[face];
        }

        scores[i] = score;
        scoreDisplay.textContent = `–û—á–∫–∏: ${score}`;
        balanceDisplay.textContent = `–ë–∞–ª–∞–Ω—Å: ${balances[i]}`;

        if (score > maxScore) {
          maxScore = score;
          winnerIndex = i;
        }
      }

      if (winnerIndex >= 0) {
        document.getElementById(`player-${winnerIndex}`).classList.add("winner");
        document.getElementById('winner').textContent = `üèÜ –ü–æ–±–µ–¥–∏–ª –ò–≥—Ä–æ–∫ ${winnerIndex + 1} —Å ${scores[winnerIndex]} –æ—á–∫–∞–º–∏!`;
        if (typeof Telegram !== 'undefined' && Telegram.WebApp?.sendData) {
          Telegram.WebApp.sendData(`–ü–æ–±–µ–¥–∏—Ç–µ–ª—å: –ò–≥—Ä–æ–∫ ${winnerIndex + 1}, –û—á–∫–∏: ${scores[winnerIndex]}`);
        }
      }
    }

    function startGame() {
      const input = document.getElementById("playerCount");
      totalPlayers = parseInt(input.value);
      createPlayers(totalPlayers);
      setTimeout(dealCards, 500);
    }

    function resetGame() {
      const input = document.getElementById("playerCount");
      totalPlayers = parseInt(input.value);
      balances = Array(totalPlayers).fill(100);
      startGame();
    }

    function increaseBet() {
      const amount = document.getElementById("betAmount");
      amount.value = parseInt(amount.value) + 5;
    }

    function doubleBet() {
      const amount = document.getElementById("betAmount");
      amount.value = parseInt(amount.value) * 2;
    }

    function fold() {
      for (let i = 0; i < totalPlayers; i++) {
        folds[i] = true;
      }
      document.getElementById('winner').textContent = "üö´ –í—Å–µ —Å–¥–∞–ª–∏—Å—å.";
    }

    function pass() {
      dealCards();
    }

    window.onload = () => {
      balances = Array(totalPlayers).fill(100);
      startGame();
    };
  </script>
</body>
</html>
